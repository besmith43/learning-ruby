<?xml version="1.0" encoding="iso-8859-1"?>
<!--
 ! Excerpted from "RubyCocoa",
 ! published by The Pragmatic Bookshelf.
 ! Copyrights apply to this code. It may not be used to create training material, 
 ! courses, books, articles, and the like. Contact us if you are in doubt.
 ! We make no guarantees that this code is fit for any purpose. 
 ! Visit http://www.pragmaticprogrammer.com/titles/bmrc for more book information.
-->
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Sequel::Dataset</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Sequel::Dataset</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/sequel_core/dataset/callback_rb.html">
                lib/sequel_core/dataset/callback.rb
                </a>
        <br />
                <a href="../../files/lib/sequel_core/dataset/convenience_rb.html">
                lib/sequel_core/dataset/convenience.rb
                </a>
        <br />
                <a href="../../files/lib/sequel_core/dataset/sequelizer_rb.html">
                lib/sequel_core/dataset/sequelizer.rb
                </a>
        <br />
                <a href="../../files/lib/sequel_core/dataset/sql_rb.html">
                lib/sequel_core/dataset/sql.rb
                </a>
        <br />
                <a href="../../files/lib/sequel_core/dataset_rb.html">
                lib/sequel_core/dataset.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="../Object.html">
                Object
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
A <a href="Dataset.html">Dataset</a> represents a view of a the data in a
database, constrained by specific parameters such as filtering conditions,
order, etc. Datasets can be used to create, retrieve, <a
href="Dataset.html#M000918">update</a> and <a
href="Dataset.html#M000919">delete</a> records.
</p>
<p>
Query results are always retrieved on demand, so a dataset can be kept
around and reused indefinitely:
</p>
<pre>
  my_posts = DB[:posts].filter(:author =&gt; 'david') # no records are retrieved
  p my_posts.all # records are now retrieved
  ...
  p my_posts.all # records are retrieved again
</pre>
<p>
In order to provide this functionality, dataset methods such as where,
select, order, etc. return modified copies of the dataset, so you can use
different datasets to access data:
</p>
<pre>
  posts = DB[:posts]
  davids_posts = posts.filter(:author =&gt; 'david')
  old_posts = posts.filter('stamp &lt; ?', 1.week.ago)
</pre>
<p>
Datasets are <a href="../Enumerable.html">Enumerable</a> objects, so they
can be manipulated using any of the <a
href="../Enumerable.html">Enumerable</a> methods, such as map, inject, etc.
</p>
<h3>The <a href="Dataset.html">Dataset</a> <a href="Adapter.html">Adapter</a> Interface</h3>
<p>
Each adapter should define its own dataset class as a descendant of <a
href="Dataset.html">Sequel::Dataset</a>. The following methods should be
overriden by the adapter <a href="Dataset.html">Dataset</a> class (<a
href="Dataset.html#M000924">each</a> method with the stock implementation):
</p>
<pre>
  # Iterate over the results of the SQL query and call the supplied
  # block with each record (as a hash).
  def fetch_rows(sql, &amp;block)
    @db.synchronize do
      r = @db.execute(sql)
      r.each(&amp;block)
    end
  end

  # Insert records.
  def insert(*values)
    @db.synchronize do
      @db.execute(insert_sql(*values)).last_insert_id
    end
  end

  # Update records.
  def update(*args, &amp;block)
    @db.synchronize do
      @db.execute(update_sql(*args, &amp;block)).affected_rows
    end
  end

  # Delete records.
  def delete(opts = nil)
    @db.synchronize do
      @db.execute(delete_sql(opts)).affected_rows
    end
  end
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000922">&lt;&lt;</a>&nbsp;&nbsp;
      <a href="#M000912">all</a>&nbsp;&nbsp;
      <a href="#M000914">clone</a>&nbsp;&nbsp;
      <a href="#M000915">clone_merge</a>&nbsp;&nbsp;
      <a href="#M000920">columns</a>&nbsp;&nbsp;
      <a href="#M000921">columns!</a>&nbsp;&nbsp;
      <a href="#M000919">delete</a>&nbsp;&nbsp;
      <a href="#M000938">each</a>&nbsp;&nbsp;
      <a href="#M000935">each</a>&nbsp;&nbsp;
      <a href="#M000936">each</a>&nbsp;&nbsp;
      <a href="#M000924">each</a>&nbsp;&nbsp;
      <a href="#M000937">each</a>&nbsp;&nbsp;
      <a href="#M000939">extend_with_destroy</a>&nbsp;&nbsp;
      <a href="#M000916">fetch_rows</a>&nbsp;&nbsp;
      <a href="#M000917">insert</a>&nbsp;&nbsp;
      <a href="#M000940">inspect</a>&nbsp;&nbsp;
      <a href="#M000925">model_classes</a>&nbsp;&nbsp;
      <a href="#M000927">naked</a>&nbsp;&nbsp;
      <a href="#M000913">new</a>&nbsp;&nbsp;
      <a href="#M000926">polymorphic_key</a>&nbsp;&nbsp;
      <a href="#M000930">remove_row_proc</a>&nbsp;&nbsp;
      <a href="#M000923">set</a>&nbsp;&nbsp;
      <a href="#M000928">set_model</a>&nbsp;&nbsp;
      <a href="#M000929">set_row_proc</a>&nbsp;&nbsp;
      <a href="#M000931">transform</a>&nbsp;&nbsp;
      <a href="#M000932">transform_load</a>&nbsp;&nbsp;
      <a href="#M000933">transform_save</a>&nbsp;&nbsp;
      <a href="#M000918">update</a>&nbsp;&nbsp;
      <a href="#M000934">update_each_method</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="../Enumerable.html">Enumerable</a></span>
        <span class="include-name"><a href="Dataset/Sequelizer.html">Sequelizer</a></span>
        <span class="include-name"><a href="Dataset/SQL.html">SQL</a></span>
        <span class="include-name"><a href="Dataset/Convenience.html">Convenience</a></span>
        <span class="include-name"><a href="Dataset/Callback.html">Callback</a></span>
      </div>
    </div>

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Module <a href="Dataset/Callback.html" class="link">Sequel::Dataset::Callback</a><br />
Module <a href="Dataset/Convenience.html" class="link">Sequel::Dataset::Convenience</a><br />
Module <a href="Dataset/SQL.html" class="link">Sequel::Dataset::SQL</a><br />
Module <a href="Dataset/Sequelizer.html" class="link">Sequel::Dataset::Sequelizer</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">NOTIMPL_MSG</td>
          <td>=</td>
          <td class="context-item-value">&quot;This method must be overriden in Sequel adapters&quot;.freeze</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">STOCK_TRANSFORMS</td>
          <td>=</td>
          <td class="context-item-value">{       :marshal =&gt; [         # for backwards-compatibility we support also non-base64-encoded values.         proc {|v| Marshal.load(Base64.decode64(v)) rescue Marshal.load(v)},          proc {|v| Base64.encode64(Marshal.dump(v))}</td>
        </tr>
        </table>
      </div>
    </div>

    <div id="aliases-list">
      <h3 class="section-bar">External Aliases</h3>

      <div class="name-list">
                        <table summary="aliases">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">count</td>
          <td>-&gt;</td>
          <td class="context-item-value">size</td>
        </tr>
                        </table>
      </div>
    </div>


    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">db</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">opts</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000938" class="method-detail">
        <a name="M000938"></a>

        <div class="method-heading">
          <a href="#M000938" class="method-signature">
          <span class="method-name">each</span><span class="method-args">(opts = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000938-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000938-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 414</span>
414:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
415:             <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
416:             <span class="ruby-keyword kw">self</span>
417:           <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000935" class="method-detail">
        <a name="M000935"></a>

        <div class="method-heading">
          <a href="#M000935" class="method-signature">
          <span class="method-name">each</span><span class="method-args">(opts = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000935-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000935-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 385</span>
385:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
386:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:naked</span>]
387:               <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>)) {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">block</span>[<span class="ruby-identifier">transform_load</span>(<span class="ruby-identifier">r</span>)]}
388:             <span class="ruby-keyword kw">else</span>
389:               <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>)) {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">block</span>[<span class="ruby-ivar">@row_proc</span>[<span class="ruby-identifier">transform_load</span>(<span class="ruby-identifier">r</span>)]]}
390:             <span class="ruby-keyword kw">end</span>
391:             <span class="ruby-keyword kw">self</span>
392:           <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000936" class="method-detail">
        <a name="M000936"></a>

        <div class="method-heading">
          <a href="#M000936" class="method-signature">
          <span class="method-name">each</span><span class="method-args">(opts = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000936-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000936-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 396</span>
396:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
397:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:naked</span>]
398:               <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
399:             <span class="ruby-keyword kw">else</span>
400:               <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>)) {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">block</span>[<span class="ruby-ivar">@row_proc</span>[<span class="ruby-identifier">r</span>]]}
401:             <span class="ruby-keyword kw">end</span>
402:             <span class="ruby-keyword kw">self</span>
403:           <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000937" class="method-detail">
        <a name="M000937"></a>

        <div class="method-heading">
          <a href="#M000937" class="method-signature">
          <span class="method-name">each</span><span class="method-args">(opts = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000937-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000937-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 407</span>
407:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
408:             <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>)) {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">block</span>[<span class="ruby-identifier">transform_load</span>(<span class="ruby-identifier">r</span>)]}
409:             <span class="ruby-keyword kw">self</span>
410:           <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000913" class="method-detail">
        <a name="M000913"></a>

        <div class="method-heading">
          <a href="#M000913" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(db, opts = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Constructs a <a href="Dataset.html#M000913">new</a> instance of a dataset
with a database instance, initial options and an optional record class.
Datasets are usually constructed by invoking <a
href="Database.html">Database</a> methods:
</p>
<pre>
  DB[:posts]
</pre>
<p>
Or:
</p>
<pre>
  DB.dataset # the returned dataset is blank
</pre>
<p>
<a href="Dataset.html">Sequel::Dataset</a> is an abstract class that is not
useful by itself. Each database adaptor should provide a descendant class
of <a href="Dataset.html">Sequel::Dataset</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000913-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000913-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 99</span>
 99:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">db</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>)
100:       <span class="ruby-ivar">@db</span> = <span class="ruby-identifier">db</span>
101:       <span class="ruby-ivar">@opts</span> = <span class="ruby-identifier">opts</span> <span class="ruby-operator">||</span> {}
102:       <span class="ruby-ivar">@row_proc</span> = <span class="ruby-keyword kw">nil</span>
103:       <span class="ruby-ivar">@transform</span> = <span class="ruby-keyword kw">nil</span>
104:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000922" class="method-detail">
        <a name="M000922"></a>

        <div class="method-heading">
          <a href="#M000922" class="method-signature">
          <span class="method-name">&lt;&lt;</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inserts the supplied values into the associated table.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000922-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000922-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 171</span>
171:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">&lt;&lt;</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
172:       <span class="ruby-identifier">insert</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
173:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000912" class="method-detail">
        <a name="M000912"></a>

        <div class="method-heading">
          <a href="#M000912" class="method-signature">
          <span class="method-name">all</span><span class="method-args">(opts = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array with <a href="Dataset.html#M000912">all</a> records in the
dataset. If a block is given, the array is iterated over.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000912-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000912-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 82</span>
82:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
83:       <span class="ruby-identifier">a</span> = []
84:       <span class="ruby-identifier">each</span>(<span class="ruby-identifier">opts</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">r</span>}
85:       <span class="ruby-identifier">run_callback</span>(<span class="ruby-identifier">:post_load</span>, <span class="ruby-identifier">a</span>)
86:       <span class="ruby-identifier">a</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
87:       <span class="ruby-identifier">a</span>
88:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000914" class="method-detail">
        <a name="M000914"></a>

        <div class="method-heading">
          <a href="#M000914" class="method-signature">
          <span class="method-name">clone</span><span class="method-args">(opts = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a <a href="Dataset.html#M000913">new</a> <a
href="Dataset.html#M000914">clone</a> of the dataset with with the given
options merged.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000914-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000914-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 107</span>
107:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">opts</span> = {})
108:       <span class="ruby-identifier">c</span> = <span class="ruby-keyword kw">super</span>()
109:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">set_options</span> <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>)
110:       <span class="ruby-identifier">c</span>
111:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000915" class="method-detail">
        <a name="M000915"></a>

        <div class="method-heading">
          <span class="method-name">clone_merge</span><span class="method-args">(opts = {})</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Dataset.html#M000914">clone</a>
</p>
        </div>
      </div>

      <div id="method-M000920" class="method-detail">
        <a name="M000920"></a>

        <div class="method-heading">
          <a href="#M000920" class="method-signature">
          <span class="method-name">columns</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="Dataset.html#M000920">columns</a> in the result <a
href="Dataset.html#M000923">set</a> in their true order. The stock
implementation returns the content of @<a
href="Dataset.html#M000920">columns</a>. If @<a
href="Dataset.html#M000920">columns</a> is nil, a query is performed.
Adapters are expected to fill @<a href="Dataset.html#M000920">columns</a>
with the column information when a query is performed.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000920-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000920-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 160</span>
160:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">columns</span>
161:       <span class="ruby-identifier">first</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@columns</span>
162:       <span class="ruby-ivar">@columns</span> <span class="ruby-operator">||</span> []
163:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000921" class="method-detail">
        <a name="M000921"></a>

        <div class="method-heading">
          <a href="#M000921" class="method-signature">
          <span class="method-name">columns!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000921-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000921-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 165</span>
165:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">columns!</span>
166:       <span class="ruby-identifier">first</span>
167:       <span class="ruby-ivar">@columns</span> <span class="ruby-operator">||</span> []
168:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000919" class="method-detail">
        <a name="M000919"></a>

        <div class="method-heading">
          <a href="#M000919" class="method-signature">
          <span class="method-name">delete</span><span class="method-args">(opts = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deletes the records in the dataset. Adapters should override this method.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000919-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000919-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 149</span>
149:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>)
150:       <span class="ruby-comment cmt"># @db.synchronize do</span>
151:       <span class="ruby-comment cmt">#   @db.execute(delete_sql(opts)).affected_rows</span>
152:       <span class="ruby-comment cmt"># end</span>
153:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-constant">NOTIMPL_MSG</span>
154:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000924" class="method-detail">
        <a name="M000924"></a>

        <div class="method-heading">
          <a href="#M000924" class="method-signature">
          <span class="method-name">each</span><span class="method-args">(opts = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Iterates over the records in the dataset
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000924-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000924-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 181</span>
181:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
182:       <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
183:       <span class="ruby-keyword kw">self</span>
184:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000939" class="method-detail">
        <a name="M000939"></a>

        <div class="method-heading">
          <a href="#M000939" class="method-signature">
          <span class="method-name">extend_with_destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Extends the dataset with a destroy method, that calls destroy for <a
href="Dataset.html#M000924">each</a> record in the dataset.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000939-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000939-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 424</span>
424:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extend_with_destroy</span>
425:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:destroy</span>)
426:         <span class="ruby-identifier">meta_def</span>(<span class="ruby-identifier">:destroy</span>) <span class="ruby-keyword kw">do</span>
427:           <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-identifier">:models</span>]
428:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;No model associated with this dataset&quot;</span>
429:           <span class="ruby-keyword kw">end</span>
430:           <span class="ruby-identifier">count</span> = <span class="ruby-value">0</span>
431:           <span class="ruby-ivar">@db</span>.<span class="ruby-identifier">transaction</span> {<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>; <span class="ruby-identifier">r</span>.<span class="ruby-identifier">destroy</span>}}
432:           <span class="ruby-identifier">count</span>
433:         <span class="ruby-keyword kw">end</span>
434:       <span class="ruby-keyword kw">end</span>
435:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000916" class="method-detail">
        <a name="M000916"></a>

        <div class="method-heading">
          <a href="#M000916" class="method-signature">
          <span class="method-name">fetch_rows</span><span class="method-args">(sql, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Executes a select query and fetches records, passing <a
href="Dataset.html#M000924">each</a> record to the supplied block. Adapters
should override this method.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000916-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000916-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 123</span>
123:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
124:       <span class="ruby-comment cmt"># @db.synchronize do</span>
125:       <span class="ruby-comment cmt">#   r = @db.execute(sql)</span>
126:       <span class="ruby-comment cmt">#   r.each(&amp;block)</span>
127:       <span class="ruby-comment cmt"># end</span>
128:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-constant">NOTIMPL_MSG</span>
129:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000917" class="method-detail">
        <a name="M000917"></a>

        <div class="method-heading">
          <a href="#M000917" class="method-signature">
          <span class="method-name">insert</span><span class="method-args">(*values)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Inserts values into the associated table. Adapters should override this
method.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000917-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000917-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 133</span>
133:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insert</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">values</span>)
134:       <span class="ruby-comment cmt"># @db.synchronize do</span>
135:       <span class="ruby-comment cmt">#   @db.execute(insert_sql(*values)).last_insert_id</span>
136:       <span class="ruby-comment cmt"># end</span>
137:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-constant">NOTIMPL_MSG</span>
138:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000940" class="method-detail">
        <a name="M000940"></a>

        <div class="method-heading">
          <a href="#M000940" class="method-signature">
          <span class="method-name">inspect</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a string representation of the dataset including the class name and
the corresponding <a href="Dataset/SQL.html">SQL</a> select statement.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000940-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000940-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 449</span>
449:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">inspect</span>
450:       <span class="ruby-value str">'#&lt;%s: %s&gt;'</span> <span class="ruby-operator">%</span> [<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">inspect</span>]
451:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000925" class="method-detail">
        <a name="M000925"></a>

        <div class="method-heading">
          <a href="#M000925" class="method-signature">
          <span class="method-name">model_classes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the the model classes associated with the dataset as a hash.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000925-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000925-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 187</span>
187:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">model_classes</span>
188:       <span class="ruby-ivar">@opts</span>[<span class="ruby-identifier">:models</span>]
189:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000927" class="method-detail">
        <a name="M000927"></a>

        <div class="method-heading">
          <a href="#M000927" class="method-signature">
          <span class="method-name">naked</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a <a href="Dataset.html#M000927">naked</a> dataset <a
href="Dataset.html#M000914">clone</a> - i.e. a dataset that returns records
as hashes rather than model objects.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000927-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000927-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 198</span>
198:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">naked</span>
199:       <span class="ruby-identifier">d</span> = <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">:naked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:models</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">:polymorphic_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>)
200:       <span class="ruby-identifier">d</span>.<span class="ruby-identifier">set_model</span>(<span class="ruby-keyword kw">nil</span>)
201:       <span class="ruby-identifier">d</span>
202:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000926" class="method-detail">
        <a name="M000926"></a>

        <div class="method-heading">
          <a href="#M000926" class="method-signature">
          <span class="method-name">polymorphic_key</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the column name for the polymorphic key.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000926-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000926-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 192</span>
192:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">polymorphic_key</span>
193:       <span class="ruby-ivar">@opts</span>[<span class="ruby-identifier">:polymorphic_key</span>]
194:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000930" class="method-detail">
        <a name="M000930"></a>

        <div class="method-heading">
          <a href="#M000930" class="method-signature">
          <span class="method-name">remove_row_proc</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Removes the row making proc.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000930-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000930-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 304</span>
304:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_row_proc</span>
305:       <span class="ruby-ivar">@row_proc</span> = <span class="ruby-keyword kw">nil</span>
306:       <span class="ruby-identifier">update_each_method</span>
307:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000923" class="method-detail">
        <a name="M000923"></a>

        <div class="method-heading">
          <a href="#M000923" class="method-signature">
          <span class="method-name">set</span><span class="method-args">(*args, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Updates the dataset with the given values.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000923-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000923-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 176</span>
176:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
177:       <span class="ruby-identifier">update</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
178:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000928" class="method-detail">
        <a name="M000928"></a>

        <div class="method-heading">
          <a href="#M000928" class="method-signature">
          <span class="method-name">set_model</span><span class="method-args">(key, *args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Associates or disassociates the dataset with a model. If no argument or nil
is specified, the dataset is turned into a <a
href="Dataset.html#M000927">naked</a> dataset and returns records as
hashes. If a model class specified, the dataset is modified to return
records as instances of the model class, e.g:
</p>
<pre>
  class MyModel
    def initialize(values)
      @values = values
      ...
    end
  end

  dataset.set_model(MyModel)
</pre>
<p>
You can also provide additional arguments to be passed to the model&#8216;s
initialize method:
</p>
<pre>
  class MyModel
    def initialize(values, options)
      @values = values
      ...
    end
  end

  dataset.set_model(MyModel, :allow_delete =&gt; false)
</pre>
<p>
The dataset can be made polymorphic by specifying a column name as the
polymorphic key and a hash mapping column values to model classes.
</p>
<pre>
  dataset.set_model(:kind, {1 =&gt; Person, 2 =&gt; Business})
</pre>
<p>
You can also <a href="Dataset.html#M000923">set</a> a default model class
to fall back on by specifying a class corresponding to nil:
</p>
<pre>
  dataset.set_model(:kind, {nil =&gt; DefaultClass, 1 =&gt; Person, 2 =&gt; Business})
</pre>
<p>
To disassociate a model from the dataset, you can call the <a
href="Dataset.html#M000928">set_model</a> and specify nil as the class:
</p>
<pre>
  dataset.set_model(nil)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000928-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000928-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 245</span>
245:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_model</span>(<span class="ruby-identifier">key</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
246:       <span class="ruby-comment cmt"># pattern matching</span>
247:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">key</span>
248:       <span class="ruby-keyword kw">when</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># set_model(nil) =&gt; no</span>
249:         <span class="ruby-comment cmt"># no argument provided, so the dataset is denuded</span>
250:         <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">:naked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:models</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">:polymorphic_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>)
251:         <span class="ruby-identifier">remove_row_proc</span>
252:         <span class="ruby-comment cmt"># extend_with_stock_each</span>
253:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Class</span>
254:         <span class="ruby-comment cmt"># isomorphic model</span>
255:         <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">:naked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">:models</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-keyword kw">nil</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>}, <span class="ruby-identifier">:polymorphic_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>)
256:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:load</span>)
257:           <span class="ruby-comment cmt"># the class has a values setter method, so we use it</span>
258:           <span class="ruby-identifier">set_row_proc</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">h</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)}
259:         <span class="ruby-keyword kw">else</span>
260:           <span class="ruby-comment cmt"># otherwise we just pass the hash to the constructor</span>
261:           <span class="ruby-identifier">set_row_proc</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">h</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)}
262:         <span class="ruby-keyword kw">end</span>
263:         <span class="ruby-identifier">extend_with_destroy</span>
264:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Symbol</span>
265:         <span class="ruby-comment cmt"># polymorphic model</span>
266:         <span class="ruby-identifier">hash</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">shift</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">raise</span>(<span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;No class hash supplied for polymorphic model&quot;</span>)
267:         <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">:naked</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:models</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">hash</span>, <span class="ruby-identifier">:polymorphic_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>)
268:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:load</span>)
269:           <span class="ruby-comment cmt"># the class has a values setter method, so we use it</span>
270:           <span class="ruby-identifier">set_row_proc</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span>
271:             <span class="ruby-identifier">c</span> = <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">h</span>[<span class="ruby-identifier">key</span>]] <span class="ruby-operator">||</span> <span class="ruby-identifier">hash</span>[<span class="ruby-keyword kw">nil</span>] <span class="ruby-operator">||</span> \
272:               <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;No matching model class for record (#{polymorphic_key} =&gt; #{h[polymorphic_key].inspect})&quot;</span>)
273:             <span class="ruby-identifier">c</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">h</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
274:           <span class="ruby-keyword kw">end</span>
275:         <span class="ruby-keyword kw">else</span>
276:           <span class="ruby-comment cmt"># otherwise we just pass the hash to the constructor</span>
277:           <span class="ruby-identifier">set_row_proc</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span>
278:             <span class="ruby-identifier">c</span> = <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">h</span>[<span class="ruby-identifier">key</span>]] <span class="ruby-operator">||</span> <span class="ruby-identifier">hash</span>[<span class="ruby-keyword kw">nil</span>] <span class="ruby-operator">||</span> \
279:               <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;No matching model class for record (#{polymorphic_key} =&gt; #{h[polymorphic_key].inspect})&quot;</span>)
280:             <span class="ruby-identifier">c</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">h</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
281:           <span class="ruby-keyword kw">end</span>
282:         <span class="ruby-keyword kw">end</span>
283:         <span class="ruby-identifier">extend_with_destroy</span>
284:       <span class="ruby-keyword kw">else</span>
285:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;Invalid model specified&quot;</span>
286:       <span class="ruby-keyword kw">end</span>
287:       <span class="ruby-keyword kw">self</span>
288:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000929" class="method-detail">
        <a name="M000929"></a>

        <div class="method-heading">
          <a href="#M000929" class="method-signature">
          <span class="method-name">set_row_proc</span><span class="method-args">(&amp;filter)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Overrides the <a href="Dataset.html#M000924">each</a> method to pass the
values through a filter. The filter receives as argument a hash containing
the column values for the current record. The filter should return a value
which is then passed to the iterating block. In order to elucidate,
here&#8216;s a contrived example:
</p>
<pre>
  dataset.set_row_proc {|h| h.merge(:xxx =&gt; 'yyy')}
  dataset.first[:xxx] #=&gt; &quot;yyy&quot; # always!
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000929-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000929-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 298</span>
298:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_row_proc</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">filter</span>)
299:       <span class="ruby-ivar">@row_proc</span> = <span class="ruby-identifier">filter</span>
300:       <span class="ruby-identifier">update_each_method</span>
301:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000931" class="method-detail">
        <a name="M000931"></a>

        <div class="method-heading">
          <a href="#M000931" class="method-signature">
          <span class="method-name">transform</span><span class="method-args">(t)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets a value <a href="Dataset.html#M000931">transform</a> which is used to
convert values loaded and saved to/from the database. The <a
href="Dataset.html#M000931">transform</a> should be supplied as a hash.
Each value in the hash should be an array containing two proc objects - one
for transforming loaded values, and one for transforming saved values. The
following example demonstrates how to store Ruby objects in a dataset using
Marshal serialization:
</p>
<pre>
  dataset.transform(:obj =&gt; [
    proc {|v| Marshal.load(v)},
    proc {|v| Marshal.dump(v)}
  ])

  dataset.insert_sql(:obj =&gt; 1234) #=&gt;
  &quot;INSERT INTO items (obj) VALUES ('\004\bi\002\322\004')&quot;
</pre>
<p>
Another form of using <a href="Dataset.html#M000931">transform</a> is by
specifying stock transforms:
</p>
<pre>
  dataset.transform(:obj =&gt; :marshal)
</pre>
<p>
The currently supported stock transforms are :marshal and :yaml.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000931-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000931-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 341</span>
341:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform</span>(<span class="ruby-identifier">t</span>)
342:       <span class="ruby-ivar">@transform</span> = <span class="ruby-identifier">t</span>
343:       <span class="ruby-identifier">t</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
344:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">v</span>
345:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
346:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">v</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">2</span>) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">v</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Proc</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">v</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Proc</span>)
347:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidTransform</span>, <span class="ruby-value str">&quot;Invalid transform specified&quot;</span>
348:           <span class="ruby-keyword kw">end</span>
349:         <span class="ruby-keyword kw">else</span>
350:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span> = <span class="ruby-constant">STOCK_TRANSFORMS</span>[<span class="ruby-identifier">v</span>]
351:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidTransform</span>, <span class="ruby-value str">&quot;Invalid transform specified&quot;</span>
352:           <span class="ruby-keyword kw">else</span>
353:             <span class="ruby-identifier">t</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
354:           <span class="ruby-keyword kw">end</span>
355:         <span class="ruby-keyword kw">end</span>
356:       <span class="ruby-keyword kw">end</span>
357:       <span class="ruby-identifier">update_each_method</span>
358:       <span class="ruby-keyword kw">self</span>
359:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000932" class="method-detail">
        <a name="M000932"></a>

        <div class="method-heading">
          <a href="#M000932" class="method-signature">
          <span class="method-name">transform_load</span><span class="method-args">(r)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Applies the value <a href="Dataset.html#M000931">transform</a> for data
loaded from the database.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000932-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000932-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 362</span>
362:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_load</span>(<span class="ruby-identifier">r</span>)
363:       <span class="ruby-identifier">r</span>.<span class="ruby-identifier">inject</span>({}) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">kv</span><span class="ruby-operator">|</span>
364:         <span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span> = <span class="ruby-operator">*</span><span class="ruby-identifier">kv</span>
365:         <span class="ruby-identifier">m</span>[<span class="ruby-identifier">k</span>] = (<span class="ruby-identifier">tt</span> = <span class="ruby-ivar">@transform</span>[<span class="ruby-identifier">k</span>]) <span class="ruby-operator">?</span> <span class="ruby-identifier">tt</span>[<span class="ruby-value">0</span>][<span class="ruby-identifier">v</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">v</span>
366:         <span class="ruby-identifier">m</span>
367:       <span class="ruby-keyword kw">end</span>
368:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000933" class="method-detail">
        <a name="M000933"></a>

        <div class="method-heading">
          <a href="#M000933" class="method-signature">
          <span class="method-name">transform_save</span><span class="method-args">(r)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Applies the value <a href="Dataset.html#M000931">transform</a> for data
saved to the database.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000933-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000933-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 371</span>
371:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">transform_save</span>(<span class="ruby-identifier">r</span>)
372:       <span class="ruby-identifier">r</span>.<span class="ruby-identifier">inject</span>({}) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">kv</span><span class="ruby-operator">|</span>
373:         <span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span> = <span class="ruby-operator">*</span><span class="ruby-identifier">kv</span>
374:         <span class="ruby-identifier">m</span>[<span class="ruby-identifier">k</span>] = (<span class="ruby-identifier">tt</span> = <span class="ruby-ivar">@transform</span>[<span class="ruby-identifier">k</span>]) <span class="ruby-operator">?</span> <span class="ruby-identifier">tt</span>[<span class="ruby-value">1</span>][<span class="ruby-identifier">v</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">v</span>
375:         <span class="ruby-identifier">m</span>
376:       <span class="ruby-keyword kw">end</span>
377:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000918" class="method-detail">
        <a name="M000918"></a>

        <div class="method-heading">
          <a href="#M000918" class="method-signature">
          <span class="method-name">update</span><span class="method-args">(values, opts = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Updates values for the dataset. Adapters should override this method.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000918-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000918-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 141</span>
141:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>(<span class="ruby-identifier">values</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>)
142:       <span class="ruby-comment cmt"># @db.synchronize do</span>
143:       <span class="ruby-comment cmt">#   @db.execute(update_sql(values, opts)).affected_rows</span>
144:       <span class="ruby-comment cmt"># end</span>
145:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-constant">NOTIMPL_MSG</span>
146:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000934" class="method-detail">
        <a name="M000934"></a>

        <div class="method-heading">
          <a href="#M000934" class="method-signature">
          <span class="method-name">update_each_method</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Updates the <a href="Dataset.html#M000924">each</a> method according to
whether @row_proc and @<a href="Dataset.html#M000931">transform</a> are <a
href="Dataset.html#M000923">set</a> or not.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000934-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000934-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sequel_core/dataset.rb, line 381</span>
381:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_each_method</span>
382:       <span class="ruby-comment cmt"># warning: ugly code generation ahead</span>
383:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@row_proc</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@transform</span>
384:         <span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>
385:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
386:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:naked</span>]
387:               <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>)) {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">block</span>[<span class="ruby-identifier">transform_load</span>(<span class="ruby-identifier">r</span>)]}
388:             <span class="ruby-keyword kw">else</span>
389:               <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>)) {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">block</span>[<span class="ruby-ivar">@row_proc</span>[<span class="ruby-identifier">transform_load</span>(<span class="ruby-identifier">r</span>)]]}
390:             <span class="ruby-keyword kw">end</span>
391:             <span class="ruby-keyword kw">self</span>
392:           <span class="ruby-keyword kw">end</span>
393:         <span class="ruby-keyword kw">end</span>
394:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@row_proc</span>
395:         <span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>
396:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
397:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opts</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:naked</span>]
398:               <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
399:             <span class="ruby-keyword kw">else</span>
400:               <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>)) {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">block</span>[<span class="ruby-ivar">@row_proc</span>[<span class="ruby-identifier">r</span>]]}
401:             <span class="ruby-keyword kw">end</span>
402:             <span class="ruby-keyword kw">self</span>
403:           <span class="ruby-keyword kw">end</span>
404:         <span class="ruby-keyword kw">end</span>
405:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@transform</span>
406:         <span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>
407:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
408:             <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>)) {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">block</span>[<span class="ruby-identifier">transform_load</span>(<span class="ruby-identifier">r</span>)]}
409:             <span class="ruby-keyword kw">self</span>
410:           <span class="ruby-keyword kw">end</span>
411:         <span class="ruby-keyword kw">end</span>
412:       <span class="ruby-keyword kw">else</span>
413:         <span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>
414:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
415:             <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>(<span class="ruby-identifier">opts</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
416:             <span class="ruby-keyword kw">self</span>
417:           <span class="ruby-keyword kw">end</span>
418:         <span class="ruby-keyword kw">end</span>
419:       <span class="ruby-keyword kw">end</span>
420:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>